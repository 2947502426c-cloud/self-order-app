<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="stylesheet" href="css/myStyle.css">
<title>好好食漢堡包Andy - 入口</title>
<link rel="icon" href="icon.png">
</head>
<body>
    <!-- 導航欄 -->
    <div class="navbar">
        <div class="navbar-brand">
            <img src="icon.png" alt="logo">
            <span class="navbar-text">好好食漢堡包</span>
        </div>
    </div>

    <!-- 表單容器 -->
    <div class="fieldset-container">
        <div class="legend">請輸入用餐信息</div>
        <div class="form-group">
            <label class="form-label">選擇枱號</label>
            <select id="tableNo" class="form-select" required>
                <option value="" hidden>請選擇</option>
                <option value="T1">T1</option>
                <option value="T2">T2</option>
                <option value="T3">T3</option>
                <option value="T4">T4</option>
                <option value="T5">T5</option>
                <option value="T6">T6</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">顧客人數</label>
            <select id="clientNo" class="form-select" required>
                <option value="" hidden>請選擇</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">用膳時間</label>
            <select id="timeLength" class="form-select" required>
                <option value="" hidden>請選擇</option>
                <option value="60">60分鐘</option>
                <option value="90">90分鐘</option>
                <option value="120">120分鐘</option>
                <option value="180">180分鐘</option>
            </select>
        </div>
        <button class="btn-submit" onclick="submitForm()">確認提交</button>
    </div>

    <!-- 只加載jQuery（用於後續點餐頁，二維碼已不依賴其他庫） -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // 表單提交處理
        function submitForm() {
            const tableNo = document.getElementById("tableNo").value;
            const clientNo = document.getElementById("clientNo").value;
            const timeLength = document.getElementById("timeLength").value;

            if (!tableNo || !clientNo || !timeLength) {
                alert("資料不齊全，請重試！");
                return;
            }

            if (!confirm("確認提交用餐信息？")) {
                return;
            }

            const formData = new FormData();
            formData.append("tableNo", tableNo);
            formData.append("clientNo", clientNo);
            formData.append("timeLength", timeLength);

            fetch("step2.php", {
                method: "POST",
                body: formData,
                cache: "no-cache"
            })
            .then(response => {
                if (!response.ok) throw new Error("網絡請求失敗");
                return response.text();
            })
            .then(url => {
                // 直接生成二維碼圖片（用公開接口，無需依賴）
                renderQRCode(url, tableNo, timeLength);
            })
            .catch(err => {
                alert("提交失敗：" + err.message);
            });
        }

        // 核心修復：用公開二維碼接口生成圖片，完全不依賴QRCode庫
        function renderQRCode(url, tableNo, timeLength) {
            // 用公開接口將URL轉換為二維碼圖片（安全穩定）
            const qrcodeImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(url.trim())}`;

            // 替換頁面內容為二維碼
            document.body.innerHTML = `
                <div class="qrcode-container">
                    <h2 class="qrcode-title">請掃碼進入點餐頁</h2>
                    <div class="qrcode-box">
                        <!-- 直接顯示二維碼圖片，不用JS生成 -->
                        <img src="${qrcodeImageUrl}" alt="點餐二維碼" style="width:220px; height:220px;">
                    </div>
                    <div class="qrcode-info">
                        枱號：${tableNo}<br>
                        用膳時間：${timeLength}分鐘
                    </div>
                    <button class="btn-print" onclick="window.print()">列印憑證</button>
                    <div style="margin-top:10px; font-size:0.9rem; color:#666;">
                        無法掃碼？直接打開：<br>
                        <a href="${url}" target="_blank" style="word-break:break-all;">${url}</a>
                    </div>
                </div>
            `;
        }
    </script>
</body>

</html>
