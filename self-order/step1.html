<!DOCTYPE html>
<html lang="en"><head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="css/myStyle.css">
<title>入口</title>
<link rel="icon" href="icon.png">
<style>
</style>
</head>
<body>
	<nav class="navbar navbar-dark bg-primary sticky-top">
        <div class="container-fluid">
            <a href="#" class="navbar-brand p-0 m-0">
                <img src="icon.png" alt="" width="44" height="44" class="d-inline-block">
            </a>
            
            <span class="navbar-text text-white">
                好好食漢堡包
            </span>
			
			<div></div>
        </div>
    </nav>
	
	<fieldset class="mx-2 my-3 fs-4">
		<legend class="alert text-center">入口處</legend>
		
		<form>
			<div class="row g-0 my-5">
				<label for="tableNo" class="col-form-label col-4">選擇枱號</label>
				<select name="tableNo" id="tableNo" onchange="showSelect(this)" class="form-select col" required="">
					<option value="" hidden="">請選擇</option>
					<option value="T1">T1</option>
					<option value="T2">T2</option>
					<option value="T3">T3</option>
					<option value="T4">T4</option>
					<option value="T5">T5</option>
					<option value="T6">T6</option>
				</select>
				<span class="col-form-label col text-center"></span>
			</div>
			
			<div class="row g-0 my-5">
				<label for="clientNo" class="col-form-label col-4">顧客人數</label>
				<select name="clientNo" id="clientNo" onchange="showSelect(this)" class="form-select col" required="">
					<option value="" hidden="">請選擇</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
				</select>
				<span class="col-form-label col text-center"></span>
			</div>

			<div class="row g-0 my-5">
				<label for="timeLength" class="col-form-label col-4">用膳時間</label>
				<select name="timeLength" id="timeLength" onchange="showSelect(this)" class="form-select col" required="">
					<option value="" hidden="">請選擇</option>
					<option value="60">60</option>
					<option value="90">90</option>
					<option value="120">120</option>
					<option value="180">180</option>
				</select>
				<span class="col-form-label col text-center"></span>
			</div>
		</form>
		
		<div class="d-grid gap-2 col-8 mx-auto">
			<button onclick="OK()" class="btn btn-primary btn-lg py-3">OK</button>
		</div>
	</fieldset>

<script src="js/jquery-3.6.0.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="js/qrcode.js"></script>
<script>
	function showSelect(el){
		$(el).next("span").text(el.value);
	}
	
	function OK(){
	    if(confirm("確認?")) checkForm();
	}
	
	function checkForm(){

	    let form = $("form")[0];
    		
		if(form.checkValidity()===true){
		    
		        let data = new FormData(form);
				sendToCloud(data);
		}else{
				alert("資料不齊全, 請重試");
		}
	}
	
	function sendToCloud(data){
	    
	    fetch("step2.php", {   // https://developer.mozilla.org/zh-TW/docs/Web/API/Fetch_API/Using_Fetch
			cache: "no-cache",
			method: "POST",
			mode: "cors",
			headers:{},     // multipart/form-data
			body: data
		})
		.then(response => {
		    
		    if(response.ok){
		        
		           return response.text();      //response.json()
		    }else{
		           throw new Error("錯誤");
		    }
		})
		.then(finalData => printTicket(finalData))
		.catch(err => console.log(err.message));
	}
	
	function printTicket(res){

	    let printArea = $("fieldset");
	        printArea.empty();
	        printArea.html(`<a href="${res}">Step 3</a><hr>`);
	        
	    let qrCode = new QRCode(printArea[0], {     // https://davidshimjs.github.io/qrcodejs/
                text: res,
                width: 200,
                height: 200,
                colorDark : "#000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
                window.print();
	}
</script>

</body></html>


